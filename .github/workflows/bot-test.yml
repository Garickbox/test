name: Test Bot Code
on: [push, workflow_dispatch]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: Test bot structure
      run: |
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ tg_bot..."
        cd tg_bot
        
        echo "1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹..."
        ls -la
        
        echo "2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ package.json..."
        if [ -f "package.json" ]; then
          cat package.json | grep -E '"name"|"version"|"dependencies"'
        else
          echo "âŒ package.json Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½!"
          exit 1
        fi
        
        echo "3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ JS..."
        node -c bot.js && echo "âœ… bot.js OK"
        node -c services.js && echo "âœ… services.js OK"
        node -c students.js && echo "âœ… students.js OK"
        
        echo "4. Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ°Ñ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ..."
        cat > test-init.js << 'EOF'
        console.log("Ğ¢ĞµÑÑ‚ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸...");
        try {
          const { CONFIG } = require('./services');
          console.log("âœ… ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½");
          console.log("Firebase project:", CONFIG.FIREBASE_ADMIN_KEY.project_id);
          console.log("Bot token ĞµÑÑ‚ÑŒ:", CONFIG.BOT_TOKEN ? "Ğ”Ğ°" : "ĞĞµÑ‚");
        } catch (e) {
          console.error("âŒ ĞÑˆĞ¸Ğ±ĞºĞ°:", e.message);
          process.exit(1);
        }
        EOF
        
        node test-init.js
        rm test-init.js
        
        echo "ğŸ‰ Ğ’ÑĞµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ñ‹!"
