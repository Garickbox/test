<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DeepSeek API</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            margin: 25px;
            padding: 20px;
            position: relative;
        }

        .warning h3 {
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .warning h3::before {
            content: "‚ö†Ô∏è";
            font-size: 1.5rem;
        }

        .warning ul {
            margin-left: 20px;
            color: #856404;
        }

        .warning li {
            margin: 8px 0;
        }

        .controls {
            padding: 0 25px 25px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
        }

        .input-group {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }

        .input-group h3 {
            color: #495057;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            margin-bottom: 15px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input[type="password"] {
            font-family: monospace;
            letter-spacing: 1px;
        }

        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(102, 126, 234, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(245, 87, 108, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .results {
            padding: 0 25px 25px;
        }

        .status {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
        }

        .status h3 {
            color: #495057;
            margin-bottom: 15px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .status-idle {
            background: #6c757d;
        }

        .status-loading {
            background: #ffc107;
            animation: pulse 1.5s infinite;
        }

        .status-success {
            background: #28a745;
        }

        .status-error {
            background: #dc3545;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .log-panel {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            color: #f8f9fa;
            font-family: 'Courier New', monospace;
            height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid #333;
            display: flex;
            gap: 15px;
        }

        .log-time {
            color: #6c757d;
            min-width: 100px;
        }

        .log-message {
            flex: 1;
        }

        .log-info {
            color: #17a2b8;
        }

        .log-success {
            color: #28a745;
        }

        .log-error {
            color: #dc3545;
        }

        .log-warning {
            color: #ffc107;
        }

        .log-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 15px;
        }

        .validity-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .valid {
            background: #28a745;
        }

        .invalid {
            background: #dc3545;
        }

        .connection-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .proxy-info {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DeepSeek API</h1>
            <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å API DeepSeek —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä</p>
        </header>

        <section class="warning">
            <h3>–í–Ω–∏–º–∞–Ω–∏–µ: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
            <ul>
                <li><strong>–ü—É–±–ª–∏—á–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ –≤–∏–¥—è—Ç –≤–∞—à API-–∫–ª—é—á!</strong> –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å production-–∫–ª—é—á–∞–º–∏</li>
                <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å</li>
                <li>–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä-–ø—Ä–æ–∫—Å–∏</li>
                <li>–ö–ª—é—á–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage –∏ –æ—á–∏—â–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</li>
            </ul>
        </section>

        <section class="controls">
            <div class="input-group">
                <h3>üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API</h3>
                
                <label for="apiKey">
                    API-–∫–ª—é—á DeepSeek:
                    <span id="keyValidity" class="validity-indicator"></span>
                </label>
                <input type="password" id="apiKey" placeholder="sk-...">
                <small style="color: #6c757d; display: block; margin-bottom: 15px;">
                    –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å "sk-". –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                </small>

                <label for="proxySelect">üåê –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä:</label>
                <select id="proxySelect">
                    <option value="corsproxy">corsproxy.io (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                    <option value="allorigins">allorigins.win</option>
                    <option value="thingproxy">thingproxy.freeboard.io</option>
                    <option value="direct">–ü—Ä—è–º–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º CORS)</option>
                </select>
                <div class="proxy-info" id="proxyInfo">
                    –¢–µ–∫—É—â–∏–π –ø—Ä–æ–∫—Å–∏: https://corsproxy.io/? 
                </div>

                <label for="testMessage">üìù –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
                <textarea id="testMessage" rows="3">–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API.</textarea>

                <div class="button-group">
                    <button id="testBtn" class="btn btn-primary">
                        <span>üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</span>
                    </button>
                    <button id="clearKeyBtn" class="btn btn-danger">
                        <span>üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–ª—é—á</span>
                    </button>
                </div>
            </div>

            <div class="input-group">
                <h3>‚öôÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                
                <label for="modelSelect">ü§ñ –ú–æ–¥–µ–ª—å:</label>
                <select id="modelSelect">
                    <option value="deepseek-chat">deepseek-chat</option>
                    <option value="deepseek-coder">deepseek-coder</option>
                </select>

                <label for="maxTokens">üéØ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤:</label>
                <input type="number" id="maxTokens" value="100" min="1" max="4096">

                <label for="temperature">üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</label>
                <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7">
                <div style="display: flex; justify-content: space-between;">
                    <span>0.0 (—Ç–æ—á–Ω—ã–π)</span>
                    <span id="tempValue">0.7</span>
                    <span>2.0 (–∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π)</span>
                </div>

                <div class="connection-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="successCount">0</div>
                        <div class="stat-label">–£—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="errorCount">0</div>
                        <div class="stat-label">–û—à–∏–±–æ–∫</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgTime">0</div>
                        <div class="stat-label">–°—Ä. –≤—Ä–µ–º—è (–º—Å)</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="results">
            <div class="status">
                <h3>
                    <span id="statusIndicator" class="status-indicator status-idle"></span>
                    –°—Ç–∞—Ç—É—Å: <span id="statusText">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</span>
                </h3>
                <div id="statusDetails">–í–≤–µ–¥–∏—Ç–µ API-–∫–ª—é—á –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"</div>
            </div>

            <h3>üìã –ñ—É—Ä–Ω–∞–ª –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
            <div class="log-actions">
                <button id="clearLogBtn" class="btn btn-danger">–û—á–∏—Å—Ç–∏—Ç—å –∂—É—Ä–Ω–∞–ª</button>
                <button id="exportLogBtn" class="btn btn-primary">–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–∞</button>
            </div>
            <div class="log-panel" id="logPanel">
                <!-- –õ–æ–≥–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
            </div>
        </section>

        <footer>
            <p>DeepSeek API Tester v1.0 | –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è | –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ GitHub Pages</p>
            <p style="font-size: 0.9rem; margin-top: 5px;">
                ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é. –ö–ª—é—á–∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
            </p>
        </footer>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const config = {
            apiEndpoint: 'https://api.deepseek.com/chat/completions',
            proxies: {
                corsproxy: 'https://corsproxy.io/?',
                allorigins: 'https://api.allorigins.win/get?url=',
                thingproxy: 'https://thingproxy.freeboard.io/fetch/',
                direct: ''
            },
            defaultModel: 'deepseek-chat',
            testMessage: '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.'
        };

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const state = {
            apiKey: '',
            isTesting: false,
            logs: [],
            stats: {
                success: 0,
                error: 0,
                totalTime: 0,
                requestCount: 0
            }
        };

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const elements = {
            apiKey: document.getElementById('apiKey'),
            testBtn: document.getElementById('testBtn'),
            clearKeyBtn: document.getElementById('clearKeyBtn'),
            clearLogBtn: document.getElementById('clearLogBtn'),
            exportLogBtn: document.getElementById('exportLogBtn'),
            proxySelect: document.getElementById('proxySelect'),
            proxyInfo: document.getElementById('proxyInfo'),
            modelSelect: document.getElementById('modelSelect'),
            maxTokens: document.getElementById('maxTokens'),
            temperature: document.getElementById('temperature'),
            tempValue: document.getElementById('tempValue'),
            testMessage: document.getElementById('testMessage'),
            statusIndicator: document.getElementById('statusIndicator'),
            statusText: document.getElementById('statusText'),
            statusDetails: document.getElementById('statusDetails'),
            logPanel: document.getElementById('logPanel'),
            keyValidity: document.getElementById('keyValidity'),
            successCount: document.getElementById('successCount'),
            errorCount: document.getElementById('errorCount'),
            avgTime: document.getElementById('avgTime')
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            addLog('üü¢ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ', 'info');
            updateStats();
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
            elements.tempValue.textContent = elements.temperature.value;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–∫—Å–∏
            updateProxyInfo();
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è API-–∫–ª—é—á–∞
        function validateApiKey(key) {
            const isValid = key.startsWith('sk-') && key.length > 10;
            elements.keyValidity.className = 'validity-indicator ' + (isValid ? 'valid' : 'invalid');
            elements.testBtn.disabled = !isValid || state.isTesting;
            return isValid;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–∫—Å–∏
        function updateProxyInfo() {
            const proxy = elements.proxySelect.value;
            let info = '';
            
            switch(proxy) {
                case 'corsproxy':
                    info = '–¢–µ–∫—É—â–∏–π –ø—Ä–æ–∫—Å–∏: https://corsproxy.io/? [–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π]';
                    break;
                case 'allorigins':
                    info = '–¢–µ–∫—É—â–∏–π –ø—Ä–æ–∫—Å–∏: https://api.allorigins.win/get?url= [–ü–æ–¥–¥–µ—Ä–∂–∫–∞ CORS]';
                    break;
                case 'thingproxy':
                    info = '–¢–µ–∫—É—â–∏–π –ø—Ä–æ–∫—Å–∏: https://thingproxy.freeboard.io/fetch/ [–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π]';
                    break;
                case 'direct':
                    info = '‚ö†Ô∏è –ü—Ä—è–º–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç CORS';
                    break;
            }
            
            elements.proxyInfo.textContent = info;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = {
                time: timestamp,
                message: message,
                type: type
            };
            
            state.logs.push(logEntry);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–æ–≤ –¥–æ 100
            if (state.logs.length > 100) {
                state.logs.shift();
            }
            
            renderLogs();
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–≥–æ–≤
        function renderLogs() {
            elements.logPanel.innerHTML = state.logs.map(log => `
                <div class="log-entry">
                    <span class="log-time">${log.time}</span>
                    <span class="log-message log-${log.type}">${log.message}</span>
                </div>
            `).join('');
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
            elements.logPanel.scrollTop = elements.logPanel.scrollHeight;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            elements.successCount.textContent = state.stats.success;
            elements.errorCount.textContent = state.stats.error;
            
            const avgTime = state.stats.requestCount > 0 
                ? Math.round(state.stats.totalTime / state.stats.requestCount)
                : 0;
            elements.avgTime.textContent = avgTime;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(text, type = 'idle', details = '') {
            elements.statusIndicator.className = `status-indicator status-${type}`;
            elements.statusText.textContent = text;
            elements.statusDetails.textContent = details;
        }

        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        async function testConnection() {
            if (state.isTesting) return;
            
            const apiKey = elements.apiKey.value.trim();
            if (!validateApiKey(apiKey)) {
                addLog('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç API-–∫–ª—é—á–∞', 'error');
                updateStatus('–û—à–∏–±–∫–∞', 'error', '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç API-–∫–ª—é—á–∞');
                return;
            }

            state.isTesting = true;
            elements.testBtn.disabled = true;
            updateStatus('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...', 'loading', '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API');
            
            const proxy = elements.proxySelect.value;
            const model = elements.modelSelect.value;
            const maxTokens = parseInt(elements.maxTokens.value);
            const temperature = parseFloat(elements.temperature.value);
            const message = elements.testMessage.value || config.testMessage;
            
            addLog(`üöÄ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: "${message.substring(0, 50)}${message.length > 50 ? '...' : ''}"`, 'info');
            
            const startTime = Date.now();
            
            try {
                const response = await sendApiRequest({
                    apiKey,
                    proxy,
                    model,
                    maxTokens,
                    temperature,
                    message
                });
                
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                state.stats.requestCount++;
                state.stats.totalTime += duration;
                
                if (response.success) {
                    state.stats.success++;
                    addLog(`‚úÖ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –∑–∞ ${duration}–º—Å: ${response.data}`, 'success');
                    updateStatus('–£—Å–ø–µ—à–Ω–æ', 'success', `–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω –∑–∞ ${duration}–º—Å`);
                } else {
                    state.stats.error++;
                    addLog(`‚ùå –û—à–∏–±–∫–∞ API: ${response.error}`, 'error');
                    updateStatus('–û—à–∏–±–∫–∞ API', 'error', response.error);
                }
            } catch (error) {
                state.stats.error++;
                addLog(`üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                updateStatus('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞', 'error', error.message);
            } finally {
                state.isTesting = false;
                elements.testBtn.disabled = !validateApiKey(apiKey);
                updateStats();
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API
        async function sendApiRequest(params) {
            const { apiKey, proxy, model, maxTokens, temperature, message } = params;
            
            const requestBody = {
                model: model,
                messages: [
                    {
                        role: "user",
                        content: message
                    }
                ],
                max_tokens: maxTokens,
                temperature: temperature,
                stream: false
            };
            
            const proxyUrl = config.proxies[proxy];
            const targetUrl = config.apiEndpoint;
            
            let finalUrl;
            let options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify(requestBody)
            };
            
            if (proxy === 'direct') {
                finalUrl = targetUrl;
            } else if (proxy === 'allorigins') {
                // allorigins —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
                finalUrl = `${proxyUrl}${encodeURIComponent(targetUrl)}`;
                options = {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify(requestBody)
                    })
                };
            } else {
                finalUrl = `${proxyUrl}${encodeURIComponent(targetUrl)}`;
            }
            
            const response = await fetch(finalUrl, options);
            
            if (proxy === 'allorigins') {
                const data = await response.json();
                if (data.contents) {
                    const apiResponse = JSON.parse(data.contents);
                    if (apiResponse.choices && apiResponse.choices[0]) {
                        return {
                            success: true,
                            data: apiResponse.choices[0].message.content
                        };
                    }
                }
                throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –ø—Ä–æ–∫—Å–∏');
            }
            
            if (!response.ok) {
                const errorText = await response.text();
                let errorMessage;
                
                try {
                    const errorJson = JSON.parse(errorText);
                    errorMessage = errorJson.error?.message || errorText;
                } catch {
                    errorMessage = errorText;
                }
                
                return {
                    success: false,
                    error: `HTTP ${response.status}: ${errorMessage}`
                };
            }
            
            const data = await response.json();
            
            if (data.choices && data.choices[0]) {
                return {
                    success: true,
                    data: data.choices[0].message.content
                };
            } else {
                return {
                    success: false,
                    error: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç API'
                };
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ –∫–ª—é—á–∞
        function clearApiKey() {
            elements.apiKey.value = '';
            validateApiKey('');
            addLog('üóëÔ∏è API-–∫–ª—é—á –æ—á–∏—â–µ–Ω', 'warning');
            updateStatus('–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'idle', '–í–≤–µ–¥–∏—Ç–µ API-–∫–ª—é—á –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
        }

        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
        function clearLogs() {
            state.logs = [];
            renderLogs();
            addLog('üìã –ñ—É—Ä–Ω–∞–ª –æ—á–∏—â–µ–Ω', 'info');
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤
        function exportLogs() {
            const logText = state.logs.map(log => 
                `[${log.time}] ${log.message}`
            ).join('\n');
            
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `deepseek-test-logs-${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addLog('üíæ –õ–æ–≥–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'info');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        elements.apiKey.addEventListener('input', (e) => {
            validateApiKey(e.target.value);
        });

        elements.testBtn.addEventListener('click', testConnection);

        elements.clearKeyBtn.addEventListener('click', clearApiKey);

        elements.clearLogBtn.addEventListener('click', clearLogs);

        elements.exportLogBtn.addEventListener('click', exportLogs);

        elements.proxySelect.addEventListener('change', updateProxyInfo);

        elements.temperature.addEventListener('input', (e) => {
            elements.tempValue.textContent = e.target.value;
        });

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                if (!state.isTesting && validateApiKey(elements.apiKey.value)) {
                    testConnection();
                }
            }
            
            if (e.key === 'Escape') {
                clearApiKey();
            }
        });

        // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', (e) => {
            if (elements.apiKey.value) {
                e.preventDefault();
                e.returnValue = 'API-–∫–ª—é—á –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω. –í—ã —É–≤–µ—Ä–µ–Ω—ã?';
            }
        });

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        init();
    </script>
</body>
</html>